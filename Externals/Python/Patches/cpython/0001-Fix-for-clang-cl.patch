From 9d5fd72ae4c57fc6d92ee38fed52c58f2b0aca52 Mon Sep 17 00:00:00 2001
From: Minmin Gong <gongminmin@msn.com>
Date: Tue, 25 Feb 2020 21:57:22 -0800
Subject: [PATCH 1/3] Fix for clang-cl

---
 Include/cpython/pytime.h | 4 ++++
 Modules/_tracemalloc.c   | 5 +++--
 2 files changed, 7 insertions(+), 2 deletions(-)

diff --git a/Include/cpython/pytime.h b/Include/cpython/pytime.h
index 23d4f16a8f..9e69c1ac36 100644
--- a/Include/cpython/pytime.h
+++ b/Include/cpython/pytime.h
@@ -45,6 +45,10 @@
 #ifndef Py_PYTIME_H
 #define Py_PYTIME_H
 
+#if defined(_MSC_VER)
+struct timeval;
+#endif
+
 /**************************************************************************
 Symbols and macros to supply platform-independent interfaces to time related
 functions and constants
diff --git a/Modules/_tracemalloc.c b/Modules/_tracemalloc.c
index 44a1f7b673..a97b55a496 100644
--- a/Modules/_tracemalloc.c
+++ b/Modules/_tracemalloc.c
@@ -59,11 +59,12 @@ static PyThread_type_lock tables_lock;
 
 /* Pack the frame_t structure to reduce the memory footprint on 64-bit
    architectures: 12 bytes instead of 16. */
+#if defined(_MSC_VER)
+#pragma pack(push, 4)
+#endif
 typedef struct
 #ifdef __GNUC__
 __attribute__((packed))
-#elif defined(_MSC_VER)
-#pragma pack(push, 4)
 #endif
 {
     /* filename cannot be NULL: "<unknown>" is used if the Python frame
-- 
2.43.0.windows.1

