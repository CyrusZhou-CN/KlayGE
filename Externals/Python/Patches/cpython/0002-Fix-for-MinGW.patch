From acf9c5735c7effec1bd01fb006fedf104d95c983 Mon Sep 17 00:00:00 2001
From: Minmin Gong <gongminmin@msn.com>
Date: Sun, 20 Jan 2019 20:21:33 -0800
Subject: [PATCH 2/3] Fix for MinGW

---
 Modules/posixmodule.c | 14 +++++++-------
 1 file changed, 7 insertions(+), 7 deletions(-)

diff --git a/Modules/posixmodule.c b/Modules/posixmodule.c
index c0421a94c1..23a05529aa 100644
--- a/Modules/posixmodule.c
+++ b/Modules/posixmodule.c
@@ -310,8 +310,8 @@ corresponding Unix manual entries for more information on calls.");
 #  define HAVE_SYSTEM     1
 #  include <process.h>
 #else
-#  ifdef _MSC_VER
-     /* Microsoft compiler */
+#  if defined(_MSC_VER) || defined(__MINGW32__)
+     /* Microsoft compiler or MinGW */
 #    define HAVE_GETPPID    1
 #    define HAVE_GETLOGIN   1
 #    define HAVE_SPAWNV     1
@@ -343,7 +343,7 @@ corresponding Unix manual entries for more information on calls.");
 #    define HAVE_SYSTEM     1
 #    define HAVE_WAIT       1
 #    define HAVE_TTYNAME    1
-#  endif  /* _MSC_VER */
+#  endif  /* _MSC_VER || __MINGW32__ */
 #endif  /* ! __WATCOMC__ || __QNX__ */
 
 _Py_IDENTIFIER(__fspath__);
@@ -354,7 +354,7 @@ module os
 [clinic start generated code]*/
 /*[clinic end generated code: output=da39a3ee5e6b4b0d input=94a0f0f978acae17]*/
 
-#ifndef _MSC_VER
+#if !defined(_MSC_VER) && !defined(__MINGW32__)
 
 #if defined(__sgi)&&_COMPILER_VERSION>=700
 /* declare ctermid_r if compiling with MIPSPro 7.x in ANSI C mode
@@ -362,7 +362,7 @@ module os
 extern char        *ctermid_r(char *);
 #endif
 
-#endif /* !_MSC_VER */
+#endif /* !_MSC_VER && !__MINGW32__ */
 
 #if defined(__VXWORKS__)
 #  include <vxCpuLib.h>
@@ -423,7 +423,7 @@ extern char        *ctermid_r(char *);
 #  endif
 #endif
 
-#ifdef _MSC_VER
+#if defined(_MSC_VER) || defined(__MINGW32__)
 #  ifdef HAVE_DIRECT_H
 #    include <direct.h>
 #  endif
@@ -434,7 +434,7 @@ extern char        *ctermid_r(char *);
 #    include <process.h>
 #  endif
 #  include <malloc.h>
-#endif /* _MSC_VER */
+#endif /* _MSC_VER || __MINGW32__ */
 
 #ifndef MAXPATHLEN
 #  if defined(PATH_MAX) && PATH_MAX > 1024
-- 
2.43.0.windows.1

